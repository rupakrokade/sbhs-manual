rho = 0.05;
dimA = 2; dimB = 2;
A = zeros(dimA,dimA); dA = 0;
[A,dA] = putin(A,dA,conv([1 -1],[1 -1.8629 0.8669]),3,1,1);
[A,dA] = putin(A,dA,conv([1 -1],[1 -1.8695 0.8737]),3,2,2);
B = zeros(dimA,dimB); dB = 0;
[B,dB] = putin(B,dB,[0.0420 -0.038],1,1,1);
[B,dB] = putin(B,dB,[0.4758 -0.4559],1,1,2);
[B,dB] = putin(B,dB,[0.0582 -0.054],1,2,1);
[B,dB] = putin(B,dB,[0.1445 -0.1361],1,2,2);
Ny = 3; Nu = 2;
j = 1;
rG = Ny*dimA; cG = Nu*dimB;
G = zeros(rG,cG);
H1 = zeros(rG,dimB);
H2 = [];
for j = 1:Ny,
    [zj,dzj] = zpowk(j);
    Zj = zeros(2,2); 
    dZj = 0;
    [Zj,dZj] = putin(Zj,dZj,zj,dzj,1,1);
    [Zj,dZj] = putin(Zj,dZj,zj,dzj,2,2);
    [Fj,dFj,Ej,dEj] = xdync(Zj,dZj,A,dA,eye(2),0);
    [Gj,dGj] = polmul(Ej,dEj,B,dB);
    m = min(j,Nu);
    Gold = extc(Gj,dGj,j);
    H1 = b_dyn(H1,Gold,j,1);
    for k = 1:m,
        Gnew = extc(Gj,dGj,j-k);
        G = b_dyn(G,Gnew,j,k);
    end
    H2 = [H2
          Fj];
end
K = inv(G'*G+rho*eye(cG))*G'
KH1 = K*H1
KH2 = K*H2

Zj =
     0     0     1     0
     0     0     0     1
dZj =
     1
Fj =
    2.8629         0   -2.7298         0    0.8669         0
         0    2.8695         0   -2.7432         0    0.8737
dFj =
     2
Ej =
     1     0
     0     1
dEj =
     0
Gj =
    0.0420    0.4758   -0.0380   -0.4559
    0.0582    0.1445   -0.0540   -0.1361
dGj =
     1
m =
     1
Gold =
   -0.0380   -0.4559
   -0.0540   -0.1361
H1 =
   -0.0380   -0.4559
   -0.0540   -0.1361
         0         0
         0         0
         0         0
         0         0
Gnew =
    0.0420    0.4758
    0.0582    0.1445
G =
    0.0420    0.4758         0         0
    0.0582    0.1445         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
H2 =
    2.8629         0   -2.7298         0    0.8669         0
         0    2.8695         0   -2.7432         0    0.8737
zj =
     0     0     1
dzj =
     2
Zj =
     0     0
     0     0
dZj =
     0
Zj =
     0     0     0     0     1     0
     0     0     0     0     0     0
dZj =
     2
Zj =
     0     0     0     0     1     0
     0     0     0     0     0     1
dZj =
     2
Fj =
    5.4664         0   -6.9482         0    2.4818         0
         0    5.4908         0   -6.9979         0    2.5071
dFj =
     2
Ej =
    1.0000         0    2.8629         0
         0    1.0000         0    2.8695
dEj =
     1
Gj =
    0.0420    0.4758    0.0822    0.9063   -0.1088   -1.3052
    0.0582    0.1445    0.1130    0.2785   -0.1550   -0.3905
dGj =
     2
m =
     2
Gold =
   -0.1088   -1.3052
   -0.1550   -0.3905
H1 =
   -0.0380   -0.4559
   -0.0540   -0.1361
   -0.1088   -1.3052
   -0.1550   -0.3905
         0         0
         0         0
Gnew =
    0.0822    0.9063
    0.1130    0.2785
G =
    0.0420    0.4758         0         0
    0.0582    0.1445         0         0
    0.0822    0.9063         0         0
    0.1130    0.2785         0         0
         0         0         0         0
         0         0         0         0
Gnew =
    0.0420    0.4758
    0.0582    0.1445
G =
    0.0420    0.4758         0         0
    0.0582    0.1445         0         0
    0.0822    0.9063    0.0420    0.4758
    0.1130    0.2785    0.0582    0.1445
         0         0         0         0
         0         0         0         0
H2 =
    2.8629         0   -2.7298         0    0.8669         0
         0    2.8695         0   -2.7432         0    0.8737
    5.4664         0   -6.9482         0    2.4818         0
         0    5.4908         0   -6.9979         0    2.5071
zj =
     0     0     0     1
dzj =
     3
Zj =
     0     0
     0     0
dZj =
     0
Zj =
     0     0     0     0     0     0     1     0
     0     0     0     0     0     0     0     0
dZj =
     3
Zj =
     0     0     0     0     0     0     1     0
     0     0     0     0     0     0     0     1
dZj =
     3
Fj =
    8.7015         0  -12.4403         0    4.7388         0
         0    8.7580         0  -12.5554         0    4.7973
dFj =
     2
Ej =
    1.0000         0    2.8629         0    5.4664         0
         0    1.0000         0    2.8695         0    5.4908
dEj =
     2
Gj =
    0.0420    0.4758    0.0822    0.9063    0.1208    1.2957   -0.2077   -2.4921
    0.0582    0.1445    0.1130    0.2785    0.1646    0.4029   -0.2965   -0.7473
dGj =
     3
m =
     2
Gold =
   -0.2077   -2.4921
   -0.2965   -0.7473
H1 =
   -0.0380   -0.4559
   -0.0540   -0.1361
   -0.1088   -1.3052
   -0.1550   -0.3905
   -0.2077   -2.4921
   -0.2965   -0.7473
Gnew =
    0.1208    1.2957
    0.1646    0.4029
G =
    0.0420    0.4758         0         0
    0.0582    0.1445         0         0
    0.0822    0.9063    0.0420    0.4758
    0.1130    0.2785    0.0582    0.1445
    0.1208    1.2957         0         0
    0.1646    0.4029         0         0
Gnew =
    0.0822    0.9063
    0.1130    0.2785
G =
    0.0420    0.4758         0         0
    0.0582    0.1445         0         0
    0.0822    0.9063    0.0420    0.4758
    0.1130    0.2785    0.0582    0.1445
    0.1208    1.2957    0.0822    0.9063
    0.1646    0.4029    0.1130    0.2785
H2 =
    2.8629         0   -2.7298         0    0.8669         0
         0    2.8695         0   -2.7432         0    0.8737
    5.4664         0   -6.9482         0    2.4818         0
         0    5.4908         0   -6.9979         0    2.5071
    8.7015         0  -12.4403         0    4.7388         0
         0    8.7580         0  -12.5554         0    4.7973
K =
   -0.0786    0.6163   -0.2763    1.0011   -0.4322    1.3661
    1.0593    0.2577    0.4888    0.0324   -0.0303   -0.1777
   -0.1375   -0.1922   -0.1959    0.4494   -0.2163    1.0564
   -1.5275   -0.4657   -0.2500   -0.1537    0.9026    0.1346
KH1 =
   -0.4706   -0.0221
   -0.0534   -0.9604
   -0.3010   -0.0815
   -0.0932   -1.2040
KH2 =
   -5.4965   19.2300    7.5116  -25.8486   -2.8022    9.6021
    5.4414   -0.6392   -5.9117    1.2978    1.9881   -0.5462
   -3.3464   11.1684    4.4270  -15.8816   -1.6303    6.0269
    2.1146   -1.0015   -5.3222    0.6632    2.3327   -0.1465
